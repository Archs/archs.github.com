<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>DSL的模式和方法</title>
  
    <meta name="description" content="thoughts about dsl">
  
    <meta name="author" content="Sun">

    <!-- Le HTML5 shim, for IE6-8 support of HTML elements -->
    <!--[if lt IE 9]>
      <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

    <!-- Le styles -->
    <link href="/assets/twitter/stylesheets/bootstrap.min.css" type="text/css" rel="stylesheet" media="all">
<link href="/assets/twitter/stylesheets/style.css" type="text/css" rel="stylesheet" media="all">
<link href="/assets/twitter/widgets/google_prettify/stylesheets/twitter-bootstrap.css" type="text/css" rel="stylesheet" media="all">
 

    <!-- Le fav and touch icons -->
  <!-- Update these with your own images
    <link rel="shortcut icon" href="images/favicon.ico">
    <link rel="apple-touch-icon" href="images/apple-touch-icon.png">
    <link rel="apple-touch-icon" sizes="72x72" href="images/apple-touch-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="114x114" href="images/apple-touch-icon-114x114.png">
  -->
  </head>

  <body>

    <div class="navbar">
      <div class="navbar-inner">
        <div class="container">
          <a class="brand" href="/">慎独</a>
          <ul class="nav">
            
              


  <li><a href="/archive">Archive</a></li>


            
              


  <li><a href="/tags">Tags</a></li>


            
              


  <li><a href="/categories">Categories</a></li>


            
              


  <li><a href="/pages">Pages</a></li>


            
              


  <li><a href="/about">About Me</a></li>


            
            <li><a href="/rss.xml">RSS</a></li>
          </ul>
        </div>
      </div>
    </div>

    <div class="container">

      <div class="content">
        <div class="page-header">
  <h1>DSL的模式和方法 </h1>
</div>

<div class="row">
  <div class="span8">
    <p>最近研究Lisp，对Domain Specific Language很是产生了一些兴趣。</p>

<p>James Gosling曾经说过： <code>每个配置文件最终都会变成一门编程语言。</code> 这大概是
DSL之所以兴起和引人关注的一点吧。另外Martin Fowler在<a href="http://book.douban.com/subject/21964984/">《领域特定语言》</a>中
强调了与领域专家的沟通作为DSL的一个主要优点和设计出发点。</p>

<p>广义的说HTML之于服务后端的业务逻辑实现和。net中XAML对于C#的代码来说都是
一种具体的DSL，所以说DSL促成了或者达到了UI和业务分离也不为过，这实际上
可以认为是领域专家（UI设计师）沟通的延伸，但是达成的效果是实实在在的。
上面举到的两个例子跟XML的关系是非同一般的紧密，同时也说了XML作为DSL载体
的优势。</p>

<h1>内部和外部DSL</h1>

<p>大体上讲DSL可以分为两种。Martin Fowler说的第三种语言工作台我不是很理解。
内部DSL与宿主语言结合紧密，实际上可以认为是宿主语言的特殊形式，这一点可
能与XML的例子大相径庭，也是我刚接触LISP的时候最困惑的一点：宿主语言自身
也可以有DSL吗？</p>

<p><a href="http://book.douban.com/subject/21964984/">《领域特定语言》</a>中定义DSL为：<code>针对某一特定领域，具有受限表达性的一种
计算机程序设计语言</code> 。</p>

<p>这里如果硬性认定 <strong>计算机程序设计语言</strong> 的话，那么好多DSL就不能被考虑在内
了。实际上DSL的定义可以相当 <strong>广泛</strong> ：具有一定模式的特殊语法形式都可以
认为DSL的一种，比如Lisper经常会自行定义的特殊语法结构，有的时候只是为了完成
一部分的功能；再比如Make和Ant都被认为是DSL的典型范例，但是它们作为计算机设
计语言都是不完备的，不仅不能算作完备，甚至连完整也称不上。</p>

<p>外部DSL就比较常规了，感觉我们通常说的DSL就是这一种了。</p>

<h1>内部DSL的几种方式</h1>

<p>看<a href="http://book.douban.com/subject/21964984/">《领域特定语言》</a>比较有收获的一点是关于内部DSL的认识，让我长了不少见识。
内部DSL可以根据宿主语言的语法特点有针对的构造，方法（不仅仅是函数）、闭包和
Literal Map都是大有帮助的语法糖，所以在面向对象和动态类型的语言里面实现起来
都是比较便利的，当然Go也其中哦。</p>

<p>经典的几种方式：</p>

<ul>
<li><p>表达式生产器</p>

<p>这种方式说是实在的与方法级联的形式差不多，主要在于对原有的命令式接口函数
的组装。这里说的表达式，就是原来的命令是的接口所谓表达式，应该就是程序
设计语言中原有的关于表达式的概念。</p></li>

<li><p>方法级联</p>

<p>这是常见的方式，广为人知的形式应该就是 <strong>jQuery的链式操作</strong> 了，很经典。不过，
如果这都算是一种DSL的话，那么DSL的范围应该是十分广泛的。一个方法级联的例子：</p>

<pre><code>computer()
    .processor()
        .cores(2)
        .speed(2500)
        .i386()
    .disk()
        .size(150)
    .dist()
        .size(75)
        .speed(7200)
        .sata()
    .end()
</code></pre>

<p>上面这种还好，不过 <strong>jQuery的链式操作</strong> 中噪杂的信息太多了，
实际上应该还是专注于宿主语言的使用了。这种形式的API好像是越来越多了，
<a href="https://code.google.com/p/google-api-go-client/">Google API的Go Client</a>也多少采用了类似的形式。</p></li>

<li><p>Literal Map</p>

<p>这种方式就要借助于宿主语言的实现方式了，支持Literal Map在脚本语言里很常见，
最近主流的静态类型语言也开始支持了，比如C#和Go。 在Go语言中这是一个很好的
特性，下面这段代码引自 <em>Go语言的Windows GUI项目<a href="https://github.com/lxn/walk/blob/master/examples/actions/actions.go">Walk</a></em></p>

<pre><code>MainWindow{
AssignTo: &amp;mw。MainWindow，
Title:    &quot;Walk Actions Example&quot;，
MenuItems: []MenuItem{
    Menu{
        Text: &quot;&amp;File&quot;,
        Items: []MenuItem{
            Action{
                AssignTo:    &amp;openAction,
                Text:        &quot;&amp;Open&quot;,
                Image:       &quot;。。/img/open。png&quot;,
                Enabled:     Bind(&quot;enabledCB。Checked&quot;),
                Visible:     Bind(&quot;openVisibleCB。Checked&quot;),
                Shortcut:    Shortcut{walk。ModControl, walk。KeyO},
                OnTriggered: mw。openAction_Triggered,
            },
            Menu{
                AssignTo: &amp;recentMenu,
                Text:     &quot;Recent&quot;,
            },
            Separator{},
            Action{
                Text:        &quot;E&amp;xit&quot;,
                OnTriggered: func() { walk。App()。Exit(0) },
            },
        },
    },
    Menu{
        Text: &quot;&amp;Help&quot;,
        Items: []MenuItem{
            Action{
                AssignTo:    &amp;showAboutBoxAction,
                Text:        &quot;About&quot;,
                OnTriggered: mw。showAboutBoxAction_Triggered,
            },
        },
    },
},
...
}
</code></pre>

<p>这段代码用<a href="https://github.com/lxn/walk/blob/master/examples/actions/actions.go">Walk</a>的说法是 <em>Declarative(声明式)</em> 的，但是正好使用了
DSL中Literal Map的形式，其本身也是Go中的Literal Map。</p></li>
</ul>

<p>另外还有 <em>嵌套函数</em> ， <em>函数序另列</em> 等形式，前者还好，在函数式编程中颇为常见，
后者就有点难受了，实现起来要严重的依赖全局变量，想来不是什么好方法吧:)</p>

<h1>程序中的几种语义模型</h1>

<p>DSL主要用来是我们的程序更加的 <em>灵活</em> ， 那么这种灵活的关键是程序中关于语法
和语义的分离。 在使用DSL的程序中建立语义模型就很关键。 下面罗列几种常见的程序
语义模型:</p>

<ul>
<li>决策表</li>
<li>依赖网络</li>
<li>产生式规则</li>
<li>状态机</li>
</ul>

<p>决策表实际上和状态机有点相似，但是实现起来略为简单一些。 依赖网络用来管理
大量数据的共生关系，可以想象一下Make中的目标和依赖，一般可以用有向无环图来
实现。 产生式规则，看起来简单，却是一个水很深的领域，早期的人工智能和应用着重
研究专家系统，而产生式系统是专家系统的基石。不过往简单的方面来考虑，使用决策树
来做产生式规则还是很直观的。</p>

    <hr>
    <div class="pagination">
      <ul>
        <ul>
          
            <li class="prev"><a href="/tips/mingw.build.lua/" title="使用Mingw Build Lua 的注意事项">&larr; Previous</a></li>
          
          

            <li><a href="/archive">Archive</a></li>

          
            <li class="next"><a href="/tips/fullpowerTinyCore/" title="在TinyCore中取代BusyBox">Next &rarr;</a></li>
          
          
        </ul>
      </ul>
    </div>
    <hr>
    
<div id="disqus_thread"></div>
<script>
    var disqus_developer = 1;
    var disqus_shortname = 'archs'; // required: replace example with your forum shortname
    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">blog comments powered by <span class="logo-disqus">Disqus</span></a>

  </div>
  
  <div class="span4">
    <h4>Published</h4>
    <div class="date"><span>2013-05-29</span></div>
    <br>
    <h4>Categories</h4>
    <ul class="tag_box">
    
      <li>
  <a href="/categories/#ProgramDesign-ref">ProgramDesign <span>1</span></a>
</li>
    
    </ul>
    <br>
    <h4>Tags</h4>
    <ul class="tag_box">
    
      <li>
  <a href="/tags/#DSL-ref">DSL <span>1</span></a>
</li>
    
      <li>
  <a href="/tags/#Lisp-ref">Lisp <span>1</span></a>
</li>
    
      <li>
  <a href="/tags/#Go-ref">Go <span>1</span></a>
</li>
    
    </ul>
    <h4>Links</h4>
    <ul>
      <a href="http://my.dot.tk/cgi-bin/amb/landing.dottk?nr=660743::12422624::1::16" target="_new"> <img src="http://images.dot.tk/content/images/1402.jpg" border="0" /></a>
    </ul>
  </div>
</div>

      </div>

      <footer>
        <p>&copy; Sun 2013 
          with help from <a href="http://github.com/wendal/gor" target="_blank" title="Gor -- Fast Blog">Gor</a>
          and <a href="http://twitter.github.com/bootstrap/" target="_blank">Twitter Bootstrap</a>
		  and Idea from <a href="http://ruhoh.com" target="_blank" title="The Definitive Technical Blogging Framework">ruhoh</a> 
        </p>
      </footer>

    </div> <!-- /container -->

    
<script src="http://cdnjs.cloudflare.com/ajax/libs/prettify/188.0.0/prettify.js"></script>
<script>
  var pres = document.getElementsByTagName("pre");
  for (var i=0; i < pres.length; ++i) {
    pres[i].className = "prettyprint ";
  }
  prettyPrint();
</script>

    
<script>
    var _gaq=[['_setAccount','UA-40026428-1'],['_trackPageview']];
    (function(d,t){var g=d.createElement(t),s=d.getElementsByTagName(t)[0];
    g.src=('https:'==location.protocol?'//ssl':'//www')+'.google-analytics.com/ga.js';
    s.parentNode.insertBefore(g,s)}(document,'script'));
</script>
  </body>
</html>
